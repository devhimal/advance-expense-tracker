{% extends "base.html" %} {% block content %}
<h1>Transaction History</h1>

<form method="get" action="{{ url_for('expense.history') }}">
  <div class="form-group">
    <label for="category">Category</label>
    <select name="category" id="category">
      <option value="">All</option>
      {% for c in categories %}
        <option value="{{ c }}" {% if c == request.args.get('category') %}selected{% endif %}>{{ c }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="form-group">
    <label for="search">Search</label>
    <input type="text" name="search" id="search" value="{{ request.args.get('search', '') }}">
  </div>
  <button type="submit">Filter</button>
  <a href="{{ url_for('expense.export_csv') }}">Export CSV</a>
  <a href="{{ url_for('expense.export_excel') }}">Export Excel</a>
  <a href="{{ url_for('expense.export_pdf') }}">Export PDF</a>
</form>

<h2>Incomes</h2>
<table>
  <tr>
    <th>Date</th>
    <th>Source</th>
    <th>Amount</th>
    <th>Description</th>
    <th>Actions</th>
  </tr>
  {% for inc in incomes %}
  <tr>
    <td>{{ inc.date }}</td>
    <td>{{ inc.source }}</td>
    <td>{{ inc.amount }}</td>
    <td>{{ inc.description }}</td>
    <td>
      <a href="{{ url_for('expense.edit_income', income_id=inc.id) }}">Edit</a>
      <form action="{{ url_for('expense.delete_income', income_id=inc.id) }}" method="post" style="display:inline;">
        <button type="submit" onclick="return confirm('Are you sure you want to delete this income?');">Delete</button>
      </form>
    </td>
  </tr>
  {% else %}
  <tr>
    <td colspan="5">No incomes yet.</td>
  </tr>
  {% endfor %}
</table>

<h2>Expenses</h2>
<table>
  <tr>
    <th>Date</th>
    <th>Category</th>
    <th>Amount</th>
    <th>Description</th>
    <th>Actions</th>
  </tr>
  {% for e in expenses %}
  <tr>
    <td>{{ e.date }}</td>
    <td>{{ e.category }}</td>
    <td>{{ e.amount }}</td>
    <td>{{ e.description }}</td>
    <td>
      <a href="{{ url_for('expense.edit_expense', expense_id=e.id) }}">Edit</a>
      <form action="{{ url_for('expense.delete_expense', expense_id=e.id) }}" method="post" style="display:inline;">
        <button type="submit" onclick="return confirm('Are you sure you want to delete this expense?');">Delete</button>
      </form>
    </td>
  </tr>
  {% else %}
  <tr>
    <td colspan="5">No expenses yet.</td>
  </tr>
  {% endfor %}
</table>
{% endblock %}
